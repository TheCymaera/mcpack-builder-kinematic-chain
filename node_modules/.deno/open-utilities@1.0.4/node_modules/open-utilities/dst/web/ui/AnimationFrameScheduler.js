import { Duration, } from "../../core/datetime/Duration.js";
export class AnimationFrameScheduler {
    constructor(callback) {
        this.#callback = callback;
        this.#handle = requestAnimationFrame(this.#onAnimationFrame);
        this.#oldTime = performance.now();
    }
    dispose() {
        cancelAnimationFrame(this.#handle);
    }
    static schedule() {
        const oldTime = performance.now();
        return new Promise(resolve => requestAnimationFrame(() => resolve(new Duration({ milliseconds: performance.now() - oldTime }))));
    }
    static periodic(callback) {
        return new AnimationFrameScheduler(callback);
    }
    #onAnimationFrame = () => {
        const oldTime = this.#oldTime;
        this.#oldTime = performance.now();
        this.#callback(new Duration({ milliseconds: this.#oldTime - oldTime }));
        this.#handle = requestAnimationFrame(this.#onAnimationFrame);
    };
    #oldTime;
    #handle;
    #callback;
}
